<div class="Main">
	<div id="Top">
		<div id="Topbar" class="BackgroundElement">
			<button *ngIf="userinfo.session == ''" class="TopbarButton" id="LoginButton" (click)="setMain('login');">Login</button>
			<button *ngIf="userinfo.session == ''" class="TopbarButton" id="RegisterButton" (click)="setMain('register');">Register</button>

			<b *ngIf="userinfo.session != ''">Logged in as {{loggedInAs}} </b>
			<button *ngIf="userinfo.session != ''" class="TopbarButton" id="LogoffButton" (click)="logoff($event);">Log off</button>

			<input type="text" placeholder="Search" id="SearchInput" [(ngModel)]="search" (ngModelChange)="searchUpdate($event)" (keyup.enter)="selectProfile($event);" matInput [matAutocomplete]="auto">
			<mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
				<mat-option *ngFor="let option of results" [value]="option.username">
					<img class="ProfilePic Thumb" [src]="option.thumbPath || 'assets/defaultProfile.png'">
					{{option.firstName + ' ' + option.lastName + ' (' + option.username + ')'}}
				</mat-option>
			</mat-autocomplete>
		</div>
	</div>
	<div id="Bottom">
		<div id="SidebarMain" class="BackgroundElement" style="height: 1000em;" #backgroundDiv>
			<h2>Navigation</h2>
			<button class="SidebarButton" id="FirstButton" (click)="setMain('feed');">
				<mat-icon class="SidebarIcon">home</mat-icon>
				Feed
			</button>

			<button *ngIf="userinfo.session != ''" class="SidebarButton" (click)="setMain('post');">
				<mat-icon class="SidebarIcon">post_add</mat-icon>
				Add Post
			</button>

			<button *ngIf="userinfo.session != ''" class="SidebarButton" (click)="selectProfile($event,userinfo);">
				<mat-icon class="SidebarIcon">account_circle</mat-icon>
				My profile
			</button>
			<button *ngIf="userinfo.session != ''" class="SidebarButton" (click)="setMain('ownprofile');">
				<mat-icon class="SidebarIcon">edit</mat-icon>
				Edit profile
			</button>
			<!--<button class="SidebarButton" (click)="setMain('settings');">Settings</button> -->
		</div>
		<div id="BodyMain" class="BackgroundElement" style="height: 1000em;" #backgroundDiv>
			<div *ngIf="bodyHTML=='login'" id="Login">
				<h2>Log in</h2>
				<label class="LogLabel">Username/Email:</label> <input type="text" placeholder="Enter your username or email" id="UserInput" [(ngModel)]="username" autocomplete="off">
				<br>
				<label class="LogLabel">Password:</label> <input type="password" placeholder="Enter your password" id="PassInput" [(ngModel)]="password" autocomplete="off">
				<br>
				<button class="MainbarButton" id="LoginMainButton" (click)="login($event)">Login</button>
				<br><br>
				<b>{{formError}}</b>
			</div>
			<div *ngIf="bodyHTML=='register'" id="Register">
				<h2>Create a new account</h2>
				<label class="LogLabel">Email:</label> <input type="text" placeholder="Enter your email adress" id="EmailInput" [(ngModel)]="email" autocomplete="off">
				<br>
				<label class="LogLabel">Username:</label> <input type="text" placeholder="Enter username" id="UserInput" [(ngModel)]="username" autocomplete="off">
				<br>
				<label class="LogLabel">Password:</label> <input type="password" placeholder="Enter password" id="PassInput" [(ngModel)]="password" autocomplete="off">
				<br>
				<button class="MainbarButton" id="RegisterMainButton" (click)="register($event)">Register</button>
				<br><br>
				<b>{{formError}}</b>
			</div>
			<div *ngIf="bodyHTML=='post'" id="AddPost">
				<h2>Add a new post</h2>
				<h3>Title</h3>
				<input type="text" placeholder="Enter your post title" id="PostTitleInput" (keypress)="noJsonSymbols($event)" [(ngModel)]="postTitle" autocomplete="off">
				<br>
				<h3>Body</h3>
				<textarea placeholder="Enter your post content" id="PostBodyInput" (keypress)="noJsonSymbols($event)" [(ngModel)]="postBody" (ngModelChange)="updateCharCounter($event)" autocomplete="off"> </textarea>
				<br>
				Characters left: {{postCharLeft}}
				<br>
				<button class="MainbarButton" id="PostMainButton" (click)="addPost($event)">Post</button>
				<br><br>
				<b>{{formError}}</b>
			</div>
			<div *ngIf="bodyHTML=='ownprofile'" id="Profile">
				<h2>Edit profile</h2>

				<h3>Change profile image</h3>
				<input class="FileUpload" type="file" accept=".png, .jpg, .jpeg, .bmp, .gif, .tiff, .tif" (change)="onAvatarChange($event)">

				<h3>Personal info</h3>
				<label class="LogLabel">First name:</label> <input type="text" placeholder="Edit your first name" id="ProfileInput" [(ngModel)]="userinfo.firstName" (keypress)="lettersOnly($event)" autocomplete="off">
				<br>
				<label class="LogLabel">Last name:</label> <input type="text" placeholder="Edit your last name" id="ProfileInput" [(ngModel)]="userinfo.lastName" (keypress)="lettersOnly($event)" autocomplete="off">

				<h3>Profile description</h3>
				<textarea placeholder="Enter your profile description" id="PostBodyInput" [(ngModel)]="userinfo.profileDesc" (ngModelChange)="updateCharCounter($event,'profile')" autocomplete="off"> </textarea>
				<br>
				Characters left: {{profileDescCharLeft}}
				<br>
				<button class="MainbarButton" id="PostMainButton" [disabled]="!updateProfileEnabled" (click)="updateProfile($event)">{{updateProfileEnabled ? "Update profile" : "Reading image.." }}</button>
				<br><br>
				<b>{{formError}}</b>
			</div>
			<div *ngIf="bodyHTML=='profile'" id="Profile">
				<img [src]="selectedProfile.avatarPath || 'assets/defaultProfile.png'" class="ProfilePic">
				<h2>{{toTitleCase(selectedProfile.firstName || "") + " " + toTitleCase(selectedProfile.lastName || "")}}</h2>
				<p>{{selectedProfile.profileDesc || "No profile description."}}</p>
				<br>
				<button *ngIf="userinfo.friends && !userinfo.friends.includes(selectedProfile.ID || -1)" class="TopbarButton" (click)="changeFriendStatus(selectedProfile,true);" >
					<mat-icon class="BodyIcon">person_add</mat-icon>
					Add to friend list
				</button>
				<h2>Posts</h2>
				<mat-paginator [length]="postList.length" [pageSize]="1" hidePageSize="true" (page)="pageEvent = $event" aria-label="Select page">
				</mat-paginator>
				<br>
				<div *ngIf="pageEvent">
					<div *ngFor="let ind of createFakeArray(pageEvent.pageSize)">
						<app-post [postClass]="'FeedPost Profile'" [profilePost]="true" *ngIf="ind < postList.length" [post]="postList[pageEvent.pageIndex * pageEvent.pageSize + ind]" [userinfo]="userinfo" [rootComponent]="this"></app-post>
					</div>
				</div>
			</div>
			<div *ngIf="bodyHTML=='feed'" id="Feed">
				<h2>{{userinfo.session == '' ? 'Feed' : 'Your Feed'}}</h2>
				<div id="FeedInner">
					<app-post *ngFor="let post of postList;" [post]="post" [userinfo]="userinfo" [rootComponent]="this"></app-post>
				</div>
			</div>
			<div *ngIf="bodyHTML=='settings'" id="Settings">
				<h2>Settings</h2>
				<label class="SettingsLabel">Setting 1: </label>
				<mat-checkbox class="SettingsCheckbox">Enable</mat-checkbox>
			</div>
			<app-comments *ngIf="bodyHTML=='comments'" [post]="selectedPost" [userinfo]="userinfo" [rootComponent]="this"></app-comments>
		</div>
		<div id="FriendbarMain" class="BackgroundElement" style="height: 1000em;" #backgroundDiv>
			<mat-tab-group *ngIf="userinfo.session != ''" (selectedTabChange)="onTabChange($event);">
				<mat-tab> 
					<ng-template mat-tab-label>
						<mat-icon class="ChatTabIcon">group</mat-icon>
						Friends
					</ng-template>

					<div id="FriendbarInner">
						<div id="FriendOption" *ngFor="let friend of friendList;">

							<button mat-button [matMenuTriggerFor]="matFriendMenu" class="FriendButton">
								<mat-icon class="BodyIcon" [style]="'color:' + (friend.online ? 'darkgreen' : 'darkred')">blur_circular</mat-icon>
								{{friend.firstName && friend.lastName ? friend.firstName + ' ' + friend.lastName : friend.username}}
							</button> 
							<mat-menu #matFriendMenu="matMenu">
								<button (click)="selectProfile($event,friend);" mat-menu-item>
									<mat-icon class="BodyIcon">account_circle</mat-icon>
									Show Profile
								</button>
								<button (click)="openChat(friend);" mat-menu-item>
									<mat-icon class="BodyIcon">chat</mat-icon>
									Message
								</button>
								<button (click)="changeFriendStatus(friend,false);" mat-menu-item>
									<mat-icon class="BodyIcon">person_remove</mat-icon>
									Remove Friend
								</button>
							</mat-menu>

						</div>
					</div>

				</mat-tab>
				<mat-tab *ngFor="let chat of chatList;">
					<ng-template mat-tab-label>
						<mat-icon class="ChatTabIcon" *ngIf="!chat.msgRequest" [style]="'color:' + (chat.recipient.online ? 'darkgreen' : 'darkred')">blur_circular</mat-icon>
						{{chat.msgRequest ? 'Message request: ' + chat.recipient.username : 'Chat: ' + chat.recipient.firstName}}
					</ng-template>

					<button class="CloseChatButton" (click)="chatList.splice(chatList.indexOf(chat,0),1);"></button>
					<div class="ChatTab" #chatDiv>
						<mat-card *ngFor="let msg of chat.messages" class="PrivateMessageCard">
							<mat-card-subtitle>{{msg.author.firstName && msg.author.lastName ? msg.author.firstName + ' ' + msg.author.lastName + ' (' + msg.author.username + ')' : msg.author.username}}</mat-card-subtitle>
							<mat-card-content>
								<p>{{msg.body}}</p>
							</mat-card-content>
							<mat-card-subtitle>Sent {{msg.date}}</mat-card-subtitle>
						</mat-card>
					</div>

					<mat-form-field class="MessageInputField" hintLabel="Max 350 characters" appearance="fill">
						<mat-label>Type your message.</mat-label>
						<textarea matInput #input maxlength="350" class="MessageInputTextArea" [placeholder]="chat.msgRequest ? 'Message here. By replying you will add ' + chat.recipient.firstName + ' to your friends list.' : 'Message here.'" (keypress)="noJsonSymbols($event)" [(ngModel)]="chatMsgField"></textarea>
						<mat-hint align="end">{{chatMsgField.length}}/350</mat-hint>
					</mat-form-field>

					<button class="FriendButton" (click)="sendMsg();">
						<mat-icon class="BodyIcon">send</mat-icon>
						{{chat.msgRequest ? 'Send message and add friend' : 'Send message'}}
					</button>
				</mat-tab>
			</mat-tab-group>
		</div>
	</div>
</div>